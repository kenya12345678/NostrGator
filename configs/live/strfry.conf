##
## Live Events Relay Configuration (NIP-53)
## Optimized for live activities, streaming, real-time events
##

# Database configuration
db = "/app/strfry-db/"
dbParams {
    maxreaders = 256
    mapsize = 5497558138880  # 5TB virtual (smaller for ephemeral content)
    noReadAhead = false
}

# Event handling - optimized for live/ephemeral content
events {
    # Standard event size
    maxEventSize = 131072

    # Accept very recent events (live content)
    rejectEventsNewerThanSeconds = 300  # 5 minutes

    # Don't keep old live events too long (30 days)
    rejectEventsOlderThanSeconds = 2592000

    # More permissive with ephemeral events
    rejectEphemeralEventsOlderThanSeconds = 300  # 5 minutes
    ephemeralEventsLifetimeSeconds = 3600  # 1 hour

    # Standard tags
    maxNumTags = 2000
    maxTagValSize = 1024
}

# Relay configuration
relay {
    bind = "0.0.0.0"
    port = 7777
    nofiles = 1000000
    realIpHeader = ""
    
    info {
        name = "Live Events Relay"
        description = "Specialized relay for live activities, streaming, and real-time events (NIP-53)"
        pubkey = ""
        contact = ""
        icon = ""
        # Focus on live events NIPs
        nips = "[1,2,4,9,11,22,28,40,50,53,70,77]"
    }
    
    maxWebsocketPayloadSize = 131072
    maxReqFilterSize = 300  # More filters for live event queries
    autoPingSeconds = 30  # Faster pings for live content
    enableTcpKeepalive = true  # Keep connections alive for live streams
    queryTimesliceBudgetMicroseconds = 5000  # Faster queries for real-time
    maxFilterLimit = 500
    maxSubsPerConnection = 30  # More subscriptions for live monitoring
    
    writePolicy {
        # Allow all writes for live events
        plugin = ""
    }
    
    compression {
        enabled = true
        slidingWindow = true
    }
    
    logging {
        dumpInAll = false
        dumpInEvents = false
        dumpInReqs = false
        dbScanPerf = false
        invalidEvents = true
    }
    
    numThreads {
        ingester = 4  # More ingesters for high-frequency events
        reqWorker = 3
        reqMonitor = 4  # More monitors for real-time filtering
        negentropy = 2
    }
    
    negentropy {
        enabled = true
        maxSyncEvents = 500000  # Smaller for ephemeral content
    }
}
