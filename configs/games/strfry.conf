##
## Games & Interactive Content Relay Configuration
## Optimized for chess, games, and interactive applications
##

# Database configuration
db = "/app/strfry-db/"
dbParams {
    maxreaders = 256
    mapsize = 5497558138880  # 5TB virtual
    noReadAhead = false
}

# Event handling - optimized for game moves and interactions
events {
    # Standard event size
    maxEventSize = 131072

    # Accept recent moves (games happen in real-time)
    rejectEventsNewerThanSeconds = 600  # 10 minutes

    # Keep game history (1 year)
    rejectEventsOlderThanSeconds = 31536000

    # Game state updates can be ephemeral
    rejectEphemeralEventsOlderThanSeconds = 300
    ephemeralEventsLifetimeSeconds = 1800  # 30 minutes

    # More tags for game metadata
    maxNumTags = 3000
    maxTagValSize = 1024
}

# Relay configuration
relay {
    bind = "0.0.0.0"
    port = 7777
    nofiles = 1000000
    realIpHeader = ""
    
    info {
        name = "Games & Interactive Relay"
        description = "Specialized relay for chess, games, and interactive applications"
        pubkey = ""
        contact = ""
        icon = ""
        # Focus on interactive content NIPs
        nips = "[1,2,4,9,11,22,28,40,50,70,77]"
    }
    
    maxWebsocketPayloadSize = 131072
    maxReqFilterSize = 400  # More filters for game state queries
    autoPingSeconds = 30  # Faster pings for interactive content
    enableTcpKeepalive = true
    queryTimesliceBudgetMicroseconds = 10000
    maxFilterLimit = 1000  # More results for game browsing
    maxSubsPerConnection = 25  # More subscriptions for game monitoring
    
    writePolicy {
        # Allow all writes for games
        plugin = ""
    }
    
    compression {
        enabled = true
        slidingWindow = true
    }
    
    logging {
        dumpInAll = false
        dumpInEvents = false
        dumpInReqs = false
        dbScanPerf = false
        invalidEvents = true
    }
    
    numThreads {
        ingester = 3
        reqWorker = 3
        reqMonitor = 4  # More monitors for game state changes
        negentropy = 2
    }
    
    negentropy {
        enabled = true
        maxSyncEvents = 1000000
    }
}
