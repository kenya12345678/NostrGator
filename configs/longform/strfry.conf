##
## Long-Form Content Relay Configuration (NIP-23)
## Optimized for articles, blogs, newsletters, and long-form content
##

# Database configuration
db = "/app/strfry-db/"
dbParams {
    maxreaders = 256
    mapsize = 10995116277760  # 10TB virtual
    noReadAhead = false
}

# Event handling - optimized for long-form content
events {
    # Larger event size for long-form content (1MB)
    maxEventSize = 1048576

    # Accept newer events (articles can be published in advance)
    rejectEventsNewerThanSeconds = 3600  # 1 hour

    # Keep articles for longer (10 years)
    rejectEventsOlderThanSeconds = 315360000

    # Ephemeral events (not relevant for articles)
    rejectEphemeralEventsOlderThanSeconds = 60
    ephemeralEventsLifetimeSeconds = 300

    # More tags for article metadata
    maxNumTags = 5000
    maxTagValSize = 2048
}

# Relay configuration
relay {
    bind = "0.0.0.0"
    port = 7777
    nofiles = 1000000
    realIpHeader = ""
    
    info {
        name = "Long-Form Content Relay"
        description = "Specialized relay for articles, blogs, newsletters and long-form content (NIP-23)"
        pubkey = ""
        contact = ""
        icon = ""
        # Focus on long-form content NIPs
        nips = "[1,2,4,9,11,22,23,28,40,50,70,77]"
    }
    
    maxWebsocketPayloadSize = 2097152  # 2MB for large articles
    maxReqFilterSize = 500  # More filters for complex article queries
    autoPingSeconds = 55
    enableTcpKeepalive = false
    queryTimesliceBudgetMicroseconds = 20000  # More time for complex queries
    maxFilterLimit = 1000  # More results for article browsing
    maxSubsPerConnection = 20
    
    writePolicy {
        # Allow all writes for long-form content
        plugin = ""
    }
    
    compression {
        enabled = true
        slidingWindow = true
    }
    
    logging {
        dumpInAll = false
        dumpInEvents = false
        dumpInReqs = false
        dbScanPerf = false
        invalidEvents = true
    }
    
    numThreads {
        ingester = 3
        reqWorker = 4  # More workers for article processing
        reqMonitor = 3
        negentropy = 2
    }
    
    negentropy {
        enabled = true
        maxSyncEvents = 1000000
    }
}
